<style type="text/css">
.heading table
{
  line-height: 5px;
}

.content table, th, td
{
  border-collapse: collapse;
  border: 0.5px solid grey;
  font-size: 10px;
}
table{
  margin: 5px;
}
td, th
{
  padding:5px;
}
.ta-right{
  text-align: right;
}
</style>

{% set currency_symbol = frappe.db.get_value("Currency", "INR", "symbol") %}

{% macro format_currency(val, precision=3) %}
  {{ currency_symbol + ' ' + format_float(val, precision) }}
{% endmacro %}

{% macro format_weight(val, precision=4) %}
  {{ format_float(val, precision) }}  
{% endmacro %}

{% macro format_float(val, precision=4) %}
  {% set s = '%.12f' % val %}
  {% set i, p, d = s.partition('.') %}
  {{ '.'.join([i, (d+'0'* (precision - d|length))[:(precision - d|length)]]) }}
{% endmacro %}

<div class="heading">
  <table style="width: 100%">
    <tr>
      <td style="width: 100%">
        <p style="text-align:center; font-style: bold;font-size: 12pt">Excelus FoodBev Pvt. Ltd.</p>
        <div style="text-align:center; font-size: 9pt">Cost Sheet</div>
      </td>
    </tr>
  </table>
  <table style="width:100%;"> 
      <tr>
        <td style="width:50%;">
          <table style="width:100%">
            <tr>
              <td style="width: 10%;text-align:left;padding-left:0px;"><b>Customer:</b></td>
              <td style="width: 90%;text-align:left;padding-left:0px;">{{ci.customer}}</td>
            </tr>
            <tr>
              <td style="width: 10%;text-align:left;padding-left:0px;"><b>Validity:</b></td>
              <td style="width: 90%;text-align:left;padding-left:0px;">{{ci.valid_to|global_date_format}} - {{ci.valid_from|global_date_format}}</td>
            </tr>
          </table>
        </td>
        <td style="width:50%;">
          <table style="width:100%">
            <tr>
              <td style="width: 80%;text-align:right;">
                Printed on:  
              </td>
              <td style="width: 20%;text-align:right; line-height: 12px;">
                {{ print_date }}
                {{ print_time }}
              </td>
            </tr>
            <tr>
              <td style="width: 80%; text-align:right;"><b>CI No.:</b></td>
              <td style="width: 20%; text-align:right;">{{ci.name}}</td>
            </tr>
            <tr>
              <td style="width: 80%; text-align:right;"><b>Date:</b></td>
              <td style="width: 20%; text-align:right;">{{ci.creation|global_date_format}}</td>
            </tr>      
          </table>
        </td> 
      </tr>
  </table>
</div>  
<hr style="margin: 0">
<div class="content">
  <table class="table table-striped table-bordered table-condensed">
    <tbody>
      <tr>
        <th style="width: 3%;">Sr No.</th>
        <th style="width: 7%;">Item Code</th>
        <th style="width: 22%;">Product</th>
        <th style="width: 5%;">Pack Weight</th>
        <th style="width: 5%; text-align: right;">Pack/Carton</th>
        <th style="width: 5%; text-align: right;">Carton Content Weight</th>
        <th style="width: 10%; text-align: right;">RM Cost/kg</th>
        <th style="width: 10%; text-align: right;">PM Cost/kg</th>
        <th style="width: 8%; text-align: right;">Processing Cost/kg</th>
        <th style="width: 10%; text-align: right;">Total Cost/kg</th>
        <th style="width: 10%; text-align: right;">Cost/case</th>
        <th style="width: 5%; text-align: right;">Cost/pouch</th>
      </tr>
      <tr>
        <td style="text-align: center;">1</td>
        <td>{{ item_details.item_code }}</td>
        <td>{{ item_details.item_name }}</td>
        <td class="ta-right">{{ item_details.pack_weight }} </td>
        <td class="ta-right">{{ item_details.packs_per_carton }}</td>
        <td class="ta-right">{{ item_details.carton_content_weight }}</td>
        <td class="ta-right">{{ format_currency(item_details.rm_cost_per_kg) }}</td>
        <td class="ta-right">{{ format_currency(item_details.pm_cost_per_kg) }}</td>
        <td class="ta-right">{{ format_currency(item_details.processing_cost_per_kg) }}</td>
        <td class="ta-right">{{ format_currency(item_details.total_cost_per_kg) }}</td>
        <td class="ta-right">{{ format_currency(item_details.cost_per_case) }}</td>
        <td class="ta-right" style="font-weight:bold">{{ format_currency(item_details.cost_per_pouch) }}</td>
      </tr>
    </tbody>
  </table>
  <br>
  <table class="table table-striped table-bordered table-condensed">
    <tbody>
        <tr>
          <th style="width: 3%;">Sr No.</th>
          <th style="width: 10%;">Item Code</th>
          <th style="width: 27%;">RM</th>
          <th style="width: 20%; text-align: right;">Qty/kg</th>
          <th style="width: 20%; text-align: right;">Rate/kg</th>
          <th style="width: 20%; text-align: right;">RM Cost/kg of FG</th>
        </tr>
        {% set idx_rm = 1 %}
        {% for rm_item in rm_items["items"] %}
          <tr>
            <td style="text-align: center;">{{ idx_rm }}</td>
            <td>{{ rm_item.item_code }}</td>
            <td>{{ rm_item.item_name }}</td>
            <td class="ta-right">{{ format_weight(rm_item.qty) }}</td>
            <td class="ta-right">{{ format_currency(rm_item.rate) }}</td>
            <td class="ta-right">{{ format_currency(rm_item.cost, 4) }}</td>
          </tr>
          {% set idx_rm = idx_rm + 1 %}
        {% endfor %}
        <tr>
          <td colspan="5" style="text-align:right;font-weight:bold">Total</td>
          <td colspan="1" style="text-align:right;font-weight:bold">{{ format_currency(rm_items["total"], 4) }}</td>
        </tr>
      </tbody>
  </table>
  <br>
  <table class="table table-striped table-bordered table-condensed">
    <tbody>
        <tr>
          <th style="width: 3%; text-align: center;">Sr No.</th>
          <th style="width: 10%;">Item Code</th>
          <th style="width: 27%;">PM</th>
          <th style="width: 10%;">PM Type</th>
          <th style="width: 10%; text-align: right;">Pack Size gm</th>
          <th style="width: 20%; text-align: right;">Packs/case</th>
          <th style="width: 20%; text-align: right;">PM Cost/kg of FG</th>
        </tr>
        {% set idx_pm = 1 %}
        {% for pm_item in pm_items["items"] %}
          <tr>
            <td style="text-align: center;">{{ idx_pm }}</td>
            <td>{{ pm_item.item_code }}</td>
            <td>{{ pm_item.item_name }}</td>
            <td>{{ pm_item.item_group }}</td>
            <td class="ta-right">{{ pm_item.qty|round(3, "floor") }}</td>
            <td class="ta-right">{{ pm_item.rate }}</td>
            <td class="ta-right">{{ format_currency(pm_item.cost, 4) }}</td>
          </tr>
          {% set idx_pm = idx_pm + 1 %}
        {% endfor %}
        <tr>
          <td colspan="6" style="text-align:right; font-weight:bold;">Total</td>
          <td colspan="1" style="text-align:right; font-weight:bold;">{{ format_currency(pm_items["total"], 4) }}</td>
        </tr>
      </tbody>
  </table>
  <br>
  <table class="table table-striped table-bordered table-condensed">
    <tbody>
      <tr>
          <th style="width: 3%">Sr No</th>
          <th style="width: 77%">Conversion</th>
          <th style="width: 20%, text-align:right;">Conv Cost/kg of FG</th>
        </tr>
        <tr>
          <td style="text-align:center">1</td>
          <td>{{ conversion_item.item_name }}</td>
          <td style="text-align:right; font-weight:bold">{{ format_currency(conversion_item.conversion_cost, 4) }}</td>
        </tr>
      </tbody>
  </table>
  <br>
</div>
<div style="page-break-after:avoid;"></div>